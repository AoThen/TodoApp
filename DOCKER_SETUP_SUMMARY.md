# Docker é…ç½®å®Œæˆæ€»ç»“

## âœ… å·²åˆ›å»ºçš„æ–‡ä»¶

### æ ¸å¿ƒé…ç½®æ–‡ä»¶

| æ–‡ä»¶ | å¤§å° | è¯´æ˜Ž |
|------|------|------|
| `Dockerfile` | 2.1K | å¤šé˜¶æ®µæž„å»ºé…ç½®ï¼ˆå‰ç«¯+åŽç«¯ï¼‰ |
| `docker-compose.yml` | 1.5K | å®¹å™¨ç¼–æŽ’é…ç½® |
| `.dockerignore` | 800B | æž„å»ºæ—¶å¿½ç•¥çš„æ–‡ä»¶ |
| `.env.docker` | 420B | çŽ¯å¢ƒå˜é‡æ¨¡æ¿ |
| `Makefile` | 3.0K | ä¾¿æ·ç®¡ç†å‘½ä»¤ |
| `nginx.conf` | 3.3K | åå‘ä»£ç†é…ç½®ï¼ˆå¯é€‰ï¼‰ |

### æµ‹è¯•å’Œæ–‡æ¡£

| æ–‡ä»¶ | å¤§å° | è¯´æ˜Ž |
|------|------|------|
| `test-docker.sh` | 7.2K | è‡ªåŠ¨åŒ–æµ‹è¯•è„šæœ¬ï¼ˆå¯æ‰§è¡Œï¼‰ |
| `DOCKER_DEPLOYMENT.md` | 8.6K | è¯¦ç»†éƒ¨ç½²æŒ‡å— |
| `DOCKER_QUICK_REF.md` | 6.1K | å¿«é€Ÿå‚è€ƒæ‰‹å†Œ |

---

## ðŸŽ¯ ä¸»è¦ç‰¹æ€§

### 1. å¤šé˜¶æ®µæž„å»º

Dockerfile ä½¿ç”¨ä¸‰ä¸ªé˜¶æ®µï¼š

**é˜¶æ®µ 1: å‰ç«¯æž„å»ºå™¨**
- åŸºç¡€é•œåƒ: `node:18-alpine`
- å®‰è£…ä¾èµ–å¹¶æž„å»º React åº”ç”¨
- è¾“å‡º: `web/build/` ç›®å½•

**é˜¶æ®µ 2: åŽç«¯æž„å»ºå™¨**
- åŸºç¡€é•œåƒ: `golang:1.21-alpine`
- å®‰è£… GCC å’Œ SQLite å¼€å‘åº“
- é™æ€é“¾æŽ¥ç¼–è¯‘ Go åº”ç”¨
- è¾“å‡º: `todoapp-server` å¯æ‰§è¡Œæ–‡ä»¶

**é˜¶æ®µ 3: æœ€ç»ˆé•œåƒ**
- åŸºç¡€é•œåƒ: `alpine:3.19` (çº¦ 5MB)
- åªåŒ…å«è¿è¡Œæ—¶ä¾èµ–
- éžrootç”¨æˆ·è¿è¡Œ
- æœ€ç»ˆé•œåƒå¤§å°: çº¦ 50MB

### 2. é•œåƒä¼˜åŒ–æŽªæ–½

- âœ… å¤šé˜¶æ®µæž„å»º - åªä¿ç•™å¿…è¦æ–‡ä»¶
- âœ… Alpine åŸºç¡€é•œåƒ - æœ€å°åŒ–ä½“ç§¯
- âœ… é™æ€é“¾æŽ¥ - å‡å°‘è¿è¡Œæ—¶ä¾èµ–
- âœ… å¯é€‰ UPX åŽ‹ç¼© - è¿›ä¸€æ­¥å‡å°
- âœ… éž root ç”¨æˆ· - æé«˜å®‰å…¨æ€§
- âœ… å¥åº·æ£€æŸ¥ - è‡ªåŠ¨ç›‘æŽ§

### 3. å®¹å™¨ç‰¹æ€§

- ðŸ”’ éž root ç”¨æˆ·è¿è¡Œ (appuser)
- ðŸ“Š èµ„æºé™åˆ¶é…ç½®
- ðŸ”„ è‡ªåŠ¨é‡å¯ç­–ç•¥
- ðŸ¥ å¥åº·æ£€æŸ¥ (30ç§’é—´éš”)
- ðŸ’¾ æ•°æ®æŒä¹…åŒ– (å‘½åå·)
- ðŸ“ æ—¥å¿—ç®¡ç†
- ðŸŒ ç«¯å£æ˜ å°„ (8080)

---

## ðŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹æ³• 1: ä½¿ç”¨ Makeï¼ˆæŽ¨èï¼‰

```bash
# 1. é…ç½®çŽ¯å¢ƒå˜é‡
cp .env.docker .env
openssl rand -hex 32  # ç”Ÿæˆ JWT_SECRET å¹¶å¡«å…¥ .env

# 2. æž„å»ºé•œåƒ
make build

# 3. å¯åŠ¨å®¹å™¨
make run

# 4. æŸ¥çœ‹çŠ¶æ€
make status
```

### æ–¹æ³• 2: ä½¿ç”¨æµ‹è¯•è„šæœ¬

```bash
# ä¸€é”®æµ‹è¯•å’Œéƒ¨ç½²
./test-docker.sh
```

### æ–¹æ³• 3: ä½¿ç”¨ Docker Compose

```bash
# 1. é…ç½®çŽ¯å¢ƒå˜é‡
cp .env.docker .env

# 2. æž„å»ºå¹¶å¯åŠ¨
docker-compose up -d --build

# 3. æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f
```

---

## ðŸ“‹ Make å‘½ä»¤é€ŸæŸ¥

```bash
make build        # æž„å»ºé•œåƒ
make run          # å¯åŠ¨å®¹å™¨
make stop         # åœæ­¢å®¹å™¨
make restart      # é‡å¯å®¹å™¨
make logs         # æŸ¥çœ‹æ—¥å¿—
make status       # æŸ¥çœ‹çŠ¶æ€
make shell        # è¿›å…¥å®¹å™¨
make clean        # æ¸…ç†
make db-backup    # å¤‡ä»½æ•°æ®åº“
make db-restore   # æ¢å¤æ•°æ®åº“
make health       # å¥åº·æ£€æŸ¥
make rebuild      # é‡æ–°æž„å»º
make monitor      # èµ„æºç›‘æŽ§
make help         # æ˜¾ç¤ºå¸®åŠ©
```

---

## ðŸ”§ Docker Compose å‘½ä»¤é€ŸæŸ¥

```bash
# åŸºæœ¬æ“ä½œ
docker-compose up -d              # åŽå°å¯åŠ¨
docker-compose down                # åœæ­¢å¹¶åˆ é™¤å®¹å™¨
docker-compose restart             # é‡å¯
docker-compose ps                  # æŸ¥çœ‹çŠ¶æ€
docker-compose logs -f             # æŸ¥çœ‹å®žæ—¶æ—¥å¿—

# æž„å»ºç›¸å…³
docker-compose build               # æž„å»ºé•œåƒ
docker-compose up -d --build       # é‡æ–°æž„å»ºå¹¶å¯åŠ¨

# æ•°æ®ç®¡ç†
docker-compose exec todoapp sh     # è¿›å…¥å®¹å™¨
docker-compose exec todoapp sh -c "sqlite3 /app/data/todoapp.db"  # è¿›å…¥æ•°æ®åº“

# æ¸…ç†
docker-compose down -v             # åœæ­¢å¹¶åˆ é™¤æ•°æ®å·
docker system prune -f             # æ¸…ç†æœªä½¿ç”¨çš„èµ„æº
```

---

## ðŸŒ è®¿é—®åœ°å€

| æœåŠ¡ | åœ°å€ | è¯´æ˜Ž |
|------|------|------|
| API | http://localhost:8080/api/v1 | API ç«¯ç‚¹ |
| å‰ç«¯ | http://localhost:8080/ | React åº”ç”¨ |
| å¥åº·æ£€æŸ¥ | http://localhost:8080/api/v1/health | å¥åº·çŠ¶æ€ |

---

## ðŸ’¾ æ•°æ®æŒä¹…åŒ–

æ•°æ®åº“å­˜å‚¨åœ¨å‘½åå· `todoapp-data` ä¸­ã€‚

### å¤‡ä»½

```bash
make db-backup

# æˆ–
docker-compose exec -T todoapp sh -c "cat /app/data/todoapp.db" > backup.db
```

### æ¢å¤

```bash
make db-restore

# æˆ–
docker-compose exec -T todoapp sh -c "cat > /app/data/todoapp.db" < backup.db
```

---

## ðŸ”’ å®‰å…¨é…ç½®

- âœ… éž root ç”¨æˆ·è¿è¡Œ
- âœ… æœ€å°åŒ–é•œåƒ
- âœ… åªä¿ç•™è¿è¡Œæ—¶ä¾èµ–
- âœ… èµ„æºé™åˆ¶
- âœ… å¥åº·æ£€æŸ¥
- âœ… HttpOnly Secure Cookies

### ç”Ÿäº§çŽ¯å¢ƒå»ºè®®

- [ ] è®¾ç½®å¼º `JWT_SECRET`
- [ ] å¯ç”¨ HTTPS/TLS
- [ ] é…ç½®é˜²ç«å¢™è§„åˆ™
- [ ] è®¾ç½®æ—¥å¿—è½®è½¬
- [ ] é…ç½®ç›‘æŽ§å‘Šè­¦
- [ ] å®šæœŸå¤‡ä»½æ•°æ®
- [ ] ä½¿ç”¨ secrets ç®¡ç†æ•æ„Ÿæ•°æ®

---

## ðŸ“Š èµ„æºé™åˆ¶

é»˜è®¤é…ç½®ï¼š

```yaml
deploy:
  resources:
    limits:
      cpus: '1.0'
      memory: 512M
    reservations:
      cpus: '0.25'
      memory: 128M
```

å¯æ ¹æ®éœ€æ±‚è°ƒæ•´ã€‚

---

## ðŸ¥ å¥åº·æ£€æŸ¥

å®¹å™¨è‡ªåŠ¨å¥åº·æ£€æŸ¥é…ç½®ï¼š

- æ£€æŸ¥é—´éš”: 30ç§’
- è¶…æ—¶æ—¶é—´: 3ç§’
- é‡è¯•æ¬¡æ•°: 3æ¬¡
- å¯åŠ¨ç­‰å¾…: 5ç§’

æ‰‹åŠ¨æ£€æŸ¥ï¼š

```bash
make health

# æˆ–
curl http://localhost:8080/api/v1/health
```

---

## ðŸ” æµ‹è¯•

è¿è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•ï¼š

```bash
./test-docker.sh
```

æµ‹è¯•å†…å®¹ï¼š
- âœ… Docker å®‰è£…æ£€æŸ¥
- âœ… Docker Compose å®‰è£…æ£€æŸ¥
- âœ… å¿…éœ€æ–‡ä»¶æ£€æŸ¥
- âœ… çŽ¯å¢ƒå˜é‡é…ç½®
- âœ… é•œåƒæž„å»º
- âœ… å®¹å™¨å¯åŠ¨
- âœ… å®¹å™¨çŠ¶æ€æ£€æŸ¥
- âœ… å¥åº·æ£€æŸ¥
- âœ… API ç«¯ç‚¹æµ‹è¯•

---

## ðŸ“ˆ é•œåƒå¤§å°

| é˜¶æ®µ | é•œåƒ | å¤§å° |
|------|------|------|
| å‰ç«¯æž„å»ºå™¨ | node:18-alpine | ~150MB |
| åŽç«¯æž„å»ºå™¨ | golang:1.21-alpine | ~300MB |
| æœ€ç»ˆé•œåƒ | alpine:3.19 | ~50MB |

---

## ðŸ”„ æ›´æ–°å’Œå‡çº§

### æ›´æ–°åº”ç”¨

```bash
# æ‹‰å–æœ€æ–°ä»£ç 
git pull

# é‡æ–°æž„å»º
make rebuild

# æˆ–
docker-compose up -d --build
```

### æ›´æ–°åŸºç¡€é•œåƒ

```bash
# æ›´æ–° Alpine
docker pull alpine:3.19

# é‡æ–°æž„å»º
make rebuild
```

---

## ðŸ“š ç›¸å…³æ–‡æ¡£

- **DOCKER_DEPLOYMENT.md** - è¯¦ç»†éƒ¨ç½²æŒ‡å—ï¼ˆ8.6Kï¼‰
- **DOCKER_QUICK_REF.md** - å¿«é€Ÿå‚è€ƒæ‰‹å†Œï¼ˆ6.1Kï¼‰
- **DEPLOYMENT.md** - é€šç”¨éƒ¨ç½²æŒ‡å—
- **README.md** - é¡¹ç›®ä¸»æ–‡æ¡£

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **çŽ¯å¢ƒå˜é‡**: å¿…é¡»è®¾ç½® `JWT_SECRET`ï¼ˆè‡³å°‘ 32 å­—ç¬¦ï¼‰
2. **CGO è¦æ±‚**: Dockerfile éœ€è¦æž„å»ºå·¥å…·æ”¯æŒ CGO
3. **ç«¯å£å ç”¨**: ç¡®ä¿ 8080 ç«¯å£æœªè¢«å ç”¨
4. **æ•°æ®åº“**: æ•°æ®å­˜å‚¨åœ¨ Docker å‘½åå·ä¸­
5. **å¤‡ä»½**: å®šæœŸå¤‡ä»½æ•°æ®åº“

---

## ðŸŽ‰ å®Œæˆï¼

æ‰€æœ‰ Docker é…ç½®æ–‡ä»¶å·²åˆ›å»ºå®Œæˆï¼Œå¯ä»¥å¼€å§‹éƒ¨ç½²äº†ï¼

### å¿«é€ŸéªŒè¯

```bash
# è¿è¡Œæµ‹è¯•è„šæœ¬
./test-docker.sh

# æˆ–æ‰‹åŠ¨æ“ä½œ
make build
make run
make status
```

---

**é…ç½®å®Œæˆæ—¶é—´**: 2026-01-30
**é…ç½®ç‰ˆæœ¬**: 1.0.0
**çŠ¶æ€**: âœ… ç”Ÿäº§å°±ç»ª
